@page
@model greenlane.Pages.GalleryModel
@{
    ViewData["Title"] = "Photo Gallery";
}

<div class="container py-5">
    <h2 class="text-center mb-4">Campus Gallery</h2>

    <!-- Filters -->
    <div class="text-center mb-4">
        <button class="btn btn-outline-dark btn-sm me-2 filter-btn active" data-filter="all">All</button>
        <button class="btn btn-outline-dark btn-sm me-2 filter-btn" data-filter="academic">Academic</button>
        <button class="btn btn-outline-dark btn-sm me-2 filter-btn" data-filter="sports">Sports</button>
        <button class="btn btn-outline-dark btn-sm me-2 filter-btn" data-filter="arts">Arts</button>
        <button class="btn btn-outline-dark btn-sm me-2 filter-btn" data-filter="events">Events</button>
        <button class="btn btn-outline-dark btn-sm filter-btn" data-filter="facilities">Facilities</button>
    </div>

    <!-- Gallery Grid -->
    <div class="row g-4" id="galleryGrid">
        @foreach (var img in Model.AllGalleryImages)
        {
            <div class="col-12 col-sm-6 col-md-4 col-lg-3 gallery-item"
                 data-category="@img.Category"
                 data-src="@img.Path"
                 data-title="@img.Name"
                 data-number="@img.Number">
                <img src="@img.Path" class="gallery-img" alt="@img.Name">
                <h6 class="text-center mt-2">@img.Name</h6>
            </div>
        }
    </div>
</div>

<style>
    .gallery-img {
        height: 230px;
        width: 100%;
        object-fit: cover;
        border-radius: 10px;
    }

    .gallery-item {
        cursor: pointer;
        transition: transform .2s ease;
    }

        .gallery-item:hover {
            transform: translateY(-5px);
        }

    .filter-btn.active {
        background-color: #212529;
        color: #fff;
    }

    .lightbox-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.95);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        flex-direction: column;
        touch-action: none;
    }

        .lightbox-overlay img {
            max-width: 90%;
            max-height: 70vh;
            border-radius: 10px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

    .lightbox-info {
        color: white;
        text-align: center;
        margin-top: 15px;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const galleryItems = Array.from(document.querySelectorAll('.gallery-item'));
        const filterButtons = document.querySelectorAll('.filter-btn');
        let currentIndex = 0;
        let lightbox = null;

        // Filtering
        filterButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const filter = btn.dataset.filter;
                filterButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                galleryItems.forEach(item => {
                    const cat = item.dataset.category;
                    item.style.display = (filter==='all' || cat===filter) ? 'block':'none';
                });
            });
        });

        // Lightbox open
        galleryItems.forEach((item, idx) => {
            item.addEventListener('click', () => {
                currentIndex = idx;
                openLightbox(currentIndex);
            });
        });

        function openLightbox(index) {
            const imgData = galleryItems[index].dataset;
            const overlay = document.createElement('div');
            overlay.className = 'lightbox-overlay';
            overlay.innerHTML = `<img src="${imgData.src}" alt="${imgData.title}"><div class="lightbox-info"><h3>${imgData.title}</h3><small>Photo #${imgData.number}</small></div>`;
            document.body.appendChild(overlay);
            lightbox = overlay;
            const img = overlay.querySelector('img');
            let startX = 0, startY = 0;

            // Swipe
            img.addEventListener('touchstart', e => { startX = e.touches[0].clientX; startY = e.touches[0].clientY; });
            img.addEventListener('touchend', e => {
                const diffX = e.changedTouches[0].clientX - startX;
                const diffY = e.changedTouches[0].clientY - startY;
                if(Math.abs(diffX)>50){ diffX<0 ? nextImage() : prevImage(); }
                else if(Math.abs(diffY)>50){ closeLightbox(); }
            });

            // Keyboard
            const keyHandler = e => {
                if(!lightbox) return;
                if(e.key==='ArrowRight') nextImage();
                if(e.key==='ArrowLeft') prevImage();
                if(e.key==='Escape') closeLightbox();
            };
            document.addEventListener('keydown', keyHandler);
            overlay.addEventListener('click', e=>{ if(e.target===overlay) closeLightbox(); });

            function nextImage(){ currentIndex=(currentIndex+1)%galleryItems.length; updateLightbox(); }
            function prevImage(){ currentIndex=(currentIndex-1+galleryItems.length)%galleryItems.length; updateLightbox(); }
            function updateLightbox(){ const imgData=galleryItems[currentIndex].dataset; img.src=imgData.src; overlay.querySelector('.lightbox-info h3').textContent=imgData.title; overlay.querySelector('.lightbox-info small').textContent=`Photo #${imgData.number}`;}
            function closeLightbox(){ overlay.remove(); lightbox=null; document.removeEventListener('keydown', keyHandler); }
        }
    });
</script>
